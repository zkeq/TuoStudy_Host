(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1598],{82502:function(e,r,t){"use strict";t.r(r),t.d(r,{__N_SSP:function(){return b},default:function(){return v}});var n=t(83242),s=t(42818),i=t.n(s),c=t(51667),a=t(40632),o=t(41999),l=t(59496),d=t(60385),u=t(4313),h=t(6985),x=t.n(h),p=t(95749),f=t(84386),m=t(84874),g=t(26362),j=t(4637),b=!0;function v(e){var r=e.accessToken,t=e.expiryTime,s=e.refreshToken,h=e.error,b=e.description,v=e.errorUri,k=(0,o.useRouter)(),y=(0,l.useState)(t),w=y[0],N=y[1],_=(0,u.$G)().t;(0,l.useEffect)((function(){if(w){var e=setInterval((function(){N(w-1)}),1e3);return function(){return clearInterval(e)}}}),[w]);var S=(0,l.useState)((0,j.jsxs)("div",{children:[(0,j.jsx)("span",{children:_("Store tokens")})," ",(0,j.jsx)(d.G,{icon:"key"})]})),G=S[0],T=S[1],E=(0,l.useState)(!1),A=E[0],P=E[1],C=function(){var e=(0,n.Z)(i().mark((function e(){var n,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P(!1),T((0,j.jsxs)("div",{children:[(0,j.jsx)("span",{children:_("Storing tokens")})," ",(0,j.jsx)(g.H,{className:"ml-1 inline h-4 w-4 animate-spin"})]})),e.next=4,(0,m.h9)(r);case 4:if(n=e.sent,c=n.data,200===n.status){e.next=11;break}return P(!0),T((0,j.jsxs)("div",{children:[(0,j.jsx)("span",{children:_("Error validating identify, restart")})," ",(0,j.jsx)(d.G,{icon:"exclamation-circle"})]})),e.abrupt("return");case 11:if(c.userPrincipalName===x().userPrincipalName){e.next=15;break}return P(!0),T((0,j.jsxs)("div",{children:[(0,j.jsx)("span",{children:_("Do not pretend to be the site owner")})," ",(0,j.jsx)(d.G,{icon:"exclamation-circle"})]})),e.abrupt("return");case 15:return e.next=17,(0,m.o8)(r,s,t).then((function(){P(!1),T((0,j.jsxs)("div",{children:[(0,j.jsx)("span",{children:_("Stored! Going home...")})," ",(0,j.jsx)(d.G,{icon:"check"})]})),setTimeout((function(){k.push("/")}),2e3)})).catch((function(e){P(!0),T((0,j.jsxs)("div",{children:[(0,j.jsx)("span",{children:_("Error storing the token")})," ",(0,j.jsx)(d.G,{icon:"exclamation-circle"})]}))}));case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,j.jsxs)("div",{className:"flex min-h-screen flex-col items-center justify-center bg-white dark:bg-gray-900",children:[(0,j.jsx)(c.default,{children:(0,j.jsx)("title",{children:_("OAuth Step 3 - {{title}}",{title:x().title})})}),(0,j.jsxs)("main",{className:"flex w-full flex-1 flex-col bg-gray-50 dark:bg-gray-800",children:[(0,j.jsx)(p.Z,{}),(0,j.jsx)("div",{className:"mx-auto w-full max-w-5xl p-4",children:(0,j.jsxs)("div",{className:"rounded bg-white p-3 dark:bg-gray-900 dark:text-gray-100",children:[(0,j.jsx)("div",{className:"mx-auto w-52",children:(0,j.jsx)(a.default,{src:"/images/fabulous-celebration.png",width:912,height:912,alt:"fabulous celebration",priority:!0})}),(0,j.jsx)("h3",{className:"mb-4 text-center text-xl font-medium",children:_("Welcome to your new onedrive-vercel-index \ud83c\udf89")}),(0,j.jsx)("h3",{className:"mt-4 mb-2 text-lg font-medium",children:_("Step 3/3: Get access and refresh tokens")}),h?(0,j.jsxs)("div",{children:[(0,j.jsxs)("p",{className:"py-1 font-medium text-red-500",children:[(0,j.jsx)(d.G,{icon:"exclamation-circle",className:"mr-2"}),(0,j.jsx)("span",{children:_("Whoops, looks like we got a problem: {{error}}.",{error:_(h)})})]}),(0,j.jsx)("p",{className:"my-2 whitespace-pre-line rounded border border-gray-400/20 bg-gray-50 p-2 font-mono text-sm opacity-80 dark:bg-gray-800",children:_(b)}),v&&(0,j.jsx)("p",{children:(0,j.jsxs)(u.cC,{children:["Check out"," ",(0,j.jsx)("a",{href:v,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline dark:text-blue-500",children:"Microsoft's official explanation"})," ","on the error message."]})}),(0,j.jsx)("div",{className:"mb-2 mt-6 text-right",children:(0,j.jsxs)("button",{className:"rounded-lg bg-gradient-to-br from-red-500 to-orange-400 px-4 py-2.5 text-center text-sm font-medium text-white hover:bg-gradient-to-bl focus:ring-4 focus:ring-red-200 disabled:cursor-not-allowed disabled:grayscale dark:focus:ring-red-800",onClick:function(){k.push("/onedrive-vercel-index-oauth/step-1")},children:[(0,j.jsx)(d.G,{icon:"arrow-left"})," ",(0,j.jsx)("span",{children:_("Restart")})]})})]}):(0,j.jsxs)("div",{children:[(0,j.jsx)("p",{className:"py-1 font-medium",children:_("Success! The API returned what we needed.")}),(0,j.jsxs)("ol",{className:"py-1",children:[r&&(0,j.jsxs)("li",{children:[(0,j.jsx)(d.G,{icon:["far","check-circle"],className:"text-green-500"})," ",(0,j.jsxs)("span",{children:[_("Acquired access_token: "),(0,j.jsx)("code",{className:"font-mono text-sm opacity-80",children:"".concat(r.substring(0,60),"...")})]})]}),s&&(0,j.jsxs)("li",{children:[(0,j.jsx)(d.G,{icon:["far","check-circle"],className:"text-green-500"})," ",(0,j.jsxs)("span",{children:[_("Acquired refresh_token: "),(0,j.jsx)("code",{className:"font-mono text-sm opacity-80",children:"".concat(s.substring(0,60),"...")})]})]})]}),(0,j.jsxs)("p",{className:"py-1 text-sm font-medium text-teal-500",children:[(0,j.jsx)(d.G,{icon:"exclamation-circle",className:"mr-1"})," ",_("These tokens may take a few seconds to populate after you click the button below. ")+_("If you go back home and still see the welcome page telling you to re-authenticate, ")+_("revisit home and do a hard refresh.")]}),(0,j.jsx)("p",{className:"py-1",children:_("Final step, click the button below to store these tokens persistently before they expire after {{minutes}} minutes {{seconds}} seconds. ",{minutes:Math.floor(w/60),seconds:w-60*Math.floor(w/60)})+_("Don't worry, after storing them, onedrive-vercel-index will take care of token refreshes and updates after your site goes live.")}),(0,j.jsx)("div",{className:"mb-2 mt-6 text-right",children:(0,j.jsx)("button",{className:"rounded-lg bg-gradient-to-br px-4 py-2.5 text-center text-sm font-medium text-white hover:bg-gradient-to-bl focus:ring-4 ".concat(A?"from-red-500 to-orange-400 focus:ring-red-200 dark:focus:ring-red-800":"from-green-500 to-teal-300 focus:ring-green-200 dark:focus:ring-green-800"),onClick:C,children:G})})]})]})})]}),(0,j.jsx)(f.Z,{})]})}},84874:function(e,r,t){"use strict";t.d(r,{mD:function(){return p},Ux:function(){return f},h9:function(){return m},o8:function(){return j}});var n=t(83242),s=t(42818),i=t.n(s),c=t(72698),a=t.n(c),o=t(30507),l=t.n(o),d=t(91904),u=t.n(d),h="onedrive-vercel-index";function x(e){return l().AES.encrypt(e,h).toString()}function p(){var e=u().clientId,r=u().redirectUri,t=u().authApi,n=u().scope,s=t.replace("/token","/authorize"),i=new URLSearchParams;return i.append("client_id",e),i.append("redirect_uri",r),i.append("response_type","code"),i.append("scope",n),i.append("response_mode","query"),"".concat(s,"?").concat(i.toString())}function f(e){var r;return e.startsWith(u().redirectUri)&&null!==(r=new URLSearchParams(e.split("?")[1]).get("code"))&&void 0!==r?r:""}function m(e){return g.apply(this,arguments)}function g(){return(g=(0,n.Z)(i().mark((function e(r){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u().driveApi.replace("/drive",""),e.abrupt("return",a().get(t,{headers:{Authorization:"Bearer ".concat(r)}}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,r,t){return b.apply(this,arguments)}function b(){return(b=(0,n.Z)(i().mark((function e(r,t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a().post("/api",{obfuscatedAccessToken:x(r),accessTokenExpiry:parseInt(n),obfuscatedRefreshToken:x(t)},{headers:{"Content-Type":"application/json"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},33850:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/onedrive-vercel-index-oauth/step-3",function(){return t(82502)}])}},function(e){e.O(0,[3614,507,6394,9774,2888,179],(function(){return r=33850,e(e.s=r);var r}));var r=e.O();_N_E=r}]);