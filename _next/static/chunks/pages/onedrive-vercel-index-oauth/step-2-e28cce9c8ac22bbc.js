(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4485],{77861:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSP:function(){return m},default:function(){return g}});var r=n(51667),a=n(40632),o=n(41999),s=n(59496),i=n(60385),c=n(4313),d=n(6985),l=n.n(d),u=n(95749),h=n(84386),p=n(26362),x=n(84874),f=n(4637),m=!0;function g(){var e=(0,o.useRouter)(),t=(0,s.useState)(""),n=t[0],d=t[1],m=(0,s.useState)(""),g=m[0],b=m[1],w=(0,s.useState)(!1),y=w[0],v=w[1],j=(0,c.$G)().t,k=(0,x.mD)();return(0,f.jsxs)("div",{className:"flex min-h-screen flex-col items-center justify-center bg-white dark:bg-gray-900",children:[(0,f.jsx)(r.default,{children:(0,f.jsx)("title",{children:j("OAuth Step 2 - {{title}}",{title:l().title})})}),(0,f.jsxs)("main",{className:"flex w-full flex-1 flex-col bg-gray-50 dark:bg-gray-800",children:[(0,f.jsx)(u.Z,{}),(0,f.jsx)("div",{className:"mx-auto w-full max-w-5xl p-4",children:(0,f.jsxs)("div",{className:"rounded bg-white p-3 dark:bg-gray-900 dark:text-gray-100",children:[(0,f.jsx)("div",{className:"mx-auto w-52",children:(0,f.jsx)(a.default,{src:"/images/fabulous-come-back-later.png",width:912,height:912,alt:"fabulous come back later",priority:!0})}),(0,f.jsx)("h3",{className:"mb-4 text-center text-xl font-medium",children:j("Welcome to your new onedrive-vercel-index \ud83c\udf89")}),(0,f.jsx)("h3",{className:"mt-4 mb-2 text-lg font-medium",children:j("Step 2/3: Get authorisation code")}),(0,f.jsx)("p",{className:"py-1 text-sm font-medium text-red-400",children:(0,f.jsxs)(c.cC,{children:[(0,f.jsx)(i.G,{icon:"exclamation-circle",className:"mr-1"})," If you are not the owner of this website, stop now, as continuing with this process may expose your personal files in OneDrive."]})}),(0,f.jsxs)("div",{className:"relative my-2 cursor-pointer rounded border border-gray-500/50 bg-gray-50 font-mono text-sm hover:opacity-80 dark:bg-gray-800",onClick:function(){window.open(k)},children:[(0,f.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-60",children:(0,f.jsx)(i.G,{icon:"external-link-alt"})}),(0,f.jsx)("pre",{className:"overflow-x-auto whitespace-pre-wrap p-2",children:(0,f.jsx)("code",{children:k})})]}),(0,f.jsx)("p",{className:"py-1",children:(0,f.jsxs)(c.cC,{children:["The OAuth link for getting the authorisation code has been created. Click on the link above to get the"," ",(0,f.jsx)("b",{className:"underline decoration-yellow-400 decoration-wavy",children:"authorisation code"}),". Your browser will","open a new tab to Microsoft's account login page. After logging in and authenticating with your Microsoft account, you will be redirected to a blank page on localhost. Paste"," ",(0,f.jsx)("b",{className:"underline decoration-teal-500 decoration-wavy",children:"the entire redirected URL"})," down below."]})}),(0,f.jsx)("div",{className:"my-4 mx-auto w-2/3 overflow-hidden rounded",children:(0,f.jsx)(a.default,{src:"/images/step-2-screenshot.png",width:1466,height:607,alt:"step 2 screenshot"})}),(0,f.jsx)("input",{className:"my-2 w-full flex-1 rounded border bg-gray-50 p-2 font-mono text-sm font-medium focus:outline-none focus:ring dark:bg-gray-800 dark:text-white ".concat(g?"border-green-500/50 focus:ring-green-500/30 dark:focus:ring-green-500/40":"border-red-500/50 focus:ring-red-500/30 dark:focus:ring-red-500/40"),autoFocus:!0,type:"text",placeholder:"http://localhost/?code=M.R3_BAY.c0...",value:n,onChange:function(e){d(e.target.value),b((0,x.Ux)(e.target.value))}}),(0,f.jsx)("p",{className:"py-1",children:j("The authorisation code extracted is:")}),(0,f.jsx)("p",{className:"my-2 overflow-hidden truncate rounded border border-gray-400/20 bg-gray-50 p-2 font-mono text-sm opacity-80 dark:bg-gray-800",children:null!==g&&void 0!==g?g:(0,f.jsx)("span",{className:"animate-pulse",children:j("Waiting for code...")})}),(0,f.jsx)("p",{children:j(g?"\u2705 You can now proceed onto the next step: requesting your access token and refresh token.":"\u274c No valid code extracted.")}),(0,f.jsx)("div",{className:"mb-2 mt-6 text-right",children:(0,f.jsx)("button",{className:"rounded-lg bg-gradient-to-br from-green-500 to-cyan-400 px-4 py-2.5 text-center text-sm font-medium text-white hover:bg-gradient-to-bl focus:ring-4 focus:ring-green-200 disabled:cursor-not-allowed disabled:grayscale dark:focus:ring-green-800",disabled:""===g,onClick:function(){v(!0),e.push({pathname:"/onedrive-vercel-index-oauth/step-3",query:{authCode:g}})},children:y?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("span",{children:j("Requesting tokens")})," ",(0,f.jsx)(p.H,{className:"ml-1 inline h-4 w-4 animate-spin"})]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("span",{children:j("Get tokens")})," ",(0,f.jsx)(i.G,{icon:"arrow-right"})]})})})]})})]}),(0,f.jsx)(h.Z,{})]})}},84874:function(e,t,n){"use strict";n.d(t,{mD:function(){return x},Ux:function(){return f},h9:function(){return m},o8:function(){return b}});var r=n(83242),a=n(42818),o=n.n(a),s=n(72698),i=n.n(s),c=n(30507),d=n.n(c),l=n(91904),u=n.n(l),h="onedrive-vercel-index";function p(e){return d().AES.encrypt(e,h).toString()}function x(){var e=u().clientId,t=u().redirectUri,n=u().authApi,r=u().scope,a=n.replace("/token","/authorize"),o=new URLSearchParams;return o.append("client_id",e),o.append("redirect_uri",t),o.append("response_type","code"),o.append("scope",r),o.append("response_mode","query"),"".concat(a,"?").concat(o.toString())}function f(e){var t;return e.startsWith(u().redirectUri)&&null!==(t=new URLSearchParams(e.split("?")[1]).get("code"))&&void 0!==t?t:""}function m(e){return g.apply(this,arguments)}function g(){return(g=(0,r.Z)(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u().driveApi.replace("/drive",""),e.abrupt("return",i().get(n,{headers:{Authorization:"Bearer ".concat(t)}}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e,t,n){return w.apply(this,arguments)}function w(){return(w=(0,r.Z)(o().mark((function e(t,n,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i().post("/api",{obfuscatedAccessToken:p(t),accessTokenExpiry:parseInt(r),obfuscatedRefreshToken:p(n)},{headers:{"Content-Type":"application/json"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},78079:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/onedrive-vercel-index-oauth/step-2",function(){return n(77861)}])}},function(e){e.O(0,[3614,507,6394,9774,2888,179],(function(){return t=78079,e(e.s=t);var t}));var t=e.O();_N_E=t}]);